<!-- Multi-Step Patient Signup Form - Sense Clinic -->
<div id="signup-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
  <div class="modal-content bg-white rounded-2xl max-w-2xl w-full max-h-[95vh] overflow-y-auto">
    
    <!-- Modal Header -->
    <div class="modal-header flex justify-between items-center p-6 border-b border-neutral-200 sticky top-0 bg-white z-10">
      <div>
        <h2 class="text-2xl font-display font-bold text-navy-800">
          Cadastro de Paciente
        </h2>
        <p class="text-sm text-navy-600 mt-1">
          Preencha suas informações para agendar sua consulta
        </p>
      </div>
      <button class="modal-close text-neutral-400 hover:text-neutral-600 text-2xl" 
              aria-label="Fechar modal">
        ×
      </button>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress-container px-6 py-4 bg-neutral-50">
      <div class="flex items-center justify-between mb-3">
        <div class="step-indicator w-8 h-8 bg-burgundy-700 text-white rounded-full flex items-center justify-center text-sm font-bold completed">1</div>
        <div class="flex-1 h-1 bg-neutral-200 mx-2">
          <div class="progress-line h-full bg-burgundy-700 transition-all duration-300" style="width: 33%"></div>
        </div>
        <div class="step-indicator w-8 h-8 bg-neutral-200 text-neutral-600 rounded-full flex items-center justify-center text-sm font-bold">2</div>
        <div class="flex-1 h-1 bg-neutral-200 mx-2">
          <div class="progress-line h-full bg-neutral-200 transition-all duration-300"></div>
        </div>
        <div class="step-indicator w-8 h-8 bg-neutral-200 text-neutral-600 rounded-full flex items-center justify-center text-sm font-bold">3</div>
        <div class="flex-1 h-1 bg-neutral-200 mx-2">
          <div class="progress-line h-full bg-neutral-200 transition-all duration-300"></div>
        </div>
        <div class="step-indicator w-8 h-8 bg-neutral-200 text-neutral-600 rounded-full flex items-center justify-center text-sm font-bold">4</div>
      </div>
      <div class="text-center">
        <span class="progress-text text-sm text-navy-600 font-medium">Etapa 1 de 4</span>
      </div>
      <div class="w-full bg-neutral-200 rounded-full h-2 mt-3">
        <div class="progress-fill bg-burgundy-700 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
    </div>
    
    <!-- Form Container -->
    <div class="modal-body p-6">
      <form id="multi-step-signup" class="multi-step-form space-y-6">
        
        <!-- Step 1: Personal Information -->
        <div class="step active" data-step="1">
          <div class="step-header mb-6">
            <h3 class="text-xl font-display font-bold text-navy-800 mb-2">
              Informações Pessoais
            </h3>
            <p class="text-navy-600">
              Vamos começar com suas informações básicas
            </p>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div class="form-group">
              <label for="first_name" class="block text-sm font-semibold text-navy-800 mb-2">
                Nome <span class="text-red-500">*</span>
              </label>
              <input type="text" 
                     id="first_name" 
                     name="first_name"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     placeholder="Seu primeiro nome"
                     required>
            </div>
            
            <div class="form-group">
              <label for="last_name" class="block text-sm font-semibold text-navy-800 mb-2">
                Sobrenome <span class="text-red-500">*</span>
              </label>
              <input type="text" 
                     id="last_name" 
                     name="last_name"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     placeholder="Seu sobrenome"
                     required>
            </div>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div class="form-group">
              <label for="cpf" class="block text-sm font-semibold text-navy-800 mb-2">
                CPF <span class="text-red-500">*</span>
              </label>
              <input type="text" 
                     id="cpf" 
                     name="cpf"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     placeholder="000.000.000-00"
                     maxlength="14"
                     required>
            </div>
            
            <div class="form-group">
              <label for="birth_date" class="block text-sm font-semibold text-navy-800 mb-2">
                Data de Nascimento <span class="text-red-500">*</span>
              </label>
              <input type="date" 
                     id="birth_date" 
                     name="birth_date"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="gender" class="block text-sm font-semibold text-navy-800 mb-2">
              Gênero <span class="text-red-500">*</span>
            </label>
            <select id="gender" 
                    name="gender"
                    class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                    required>
              <option value="">Selecione...</option>
              <option value="female">Feminino</option>
              <option value="male">Masculino</option>
              <option value="non_binary">Não-binário</option>
              <option value="prefer_not_to_say">Prefiro não informar</option>
            </select>
          </div>
        </div>
        
        <!-- Step 2: Contact Information -->
        <div class="step hidden" data-step="2">
          <div class="step-header mb-6">
            <h3 class="text-xl font-display font-bold text-navy-800 mb-2">
              Informações de Contato
            </h3>
            <p class="text-navy-600">
              Como podemos entrar em contato com você?
            </p>
          </div>
          
          <div class="form-group">
            <label for="email" class="block text-sm font-semibold text-navy-800 mb-2">
              Email <span class="text-red-500">*</span>
            </label>
            <input type="email" 
                   id="email" 
                   name="email"
                   class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                   placeholder="seu.email@exemplo.com"
                   required>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div class="form-group">
              <label for="phone" class="block text-sm font-semibold text-navy-800 mb-2">
                Telefone <span class="text-red-500">*</span>
              </label>
              <input type="tel" 
                     id="phone" 
                     name="phone"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     placeholder="(11) 99999-9999"
                     required>
            </div>
            
            <div class="form-group">
              <label for="phone_type" class="block text-sm font-semibold text-navy-800 mb-2">
                Tipo de Telefone
              </label>
              <select id="phone_type" 
                      name="phone_type"
                      class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors">
                <option value="mobile">Celular</option>
                <option value="home">Residencial</option>
                <option value="work">Comercial</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="address" class="block text-sm font-semibold text-navy-800 mb-2">
              Endereço <span class="text-red-500">*</span>
            </label>
            <input type="text" 
                   id="address" 
                   name="address"
                   class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                   placeholder="Rua, número, complemento"
                   required>
          </div>
          
          <div class="grid md:grid-cols-3 gap-4">
            <div class="form-group">
              <label for="city" class="block text-sm font-semibold text-navy-800 mb-2">
                Cidade <span class="text-red-500">*</span>
              </label>
              <input type="text" 
                     id="city" 
                     name="city"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     placeholder="Sua cidade"
                     required>
            </div>
            
            <div class="form-group">
              <label for="state" class="block text-sm font-semibold text-navy-800 mb-2">
                Estado <span class="text-red-500">*</span>
              </label>
              <select id="state" 
                      name="state"
                      class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                      required>
                <option value="">UF</option>
                <option value="SP">SP</option>
                <option value="RJ">RJ</option>
                <option value="MG">MG</option>
                <option value="RS">RS</option>
                <option value="PR">PR</option>
                <option value="SC">SC</option>
                <option value="BA">BA</option>
                <option value="GO">GO</option>
                <option value="PE">PE</option>
                <option value="CE">CE</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="zipcode" class="block text-sm font-semibold text-navy-800 mb-2">
                CEP <span class="text-red-500">*</span>
              </label>
              <input type="text" 
                     id="zipcode" 
                     name="zipcode"
                     class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                     placeholder="00000-000"
                     maxlength="9"
                     required>
            </div>
          </div>
        </div>
        
        <!-- Step 3: Medical Information -->
        <div class="step hidden" data-step="3">
          <div class="step-header mb-6">
            <h3 class="text-xl font-display font-bold text-navy-800 mb-2">
              Informações Médicas
            </h3>
            <p class="text-navy-600">
              Nos ajude a entender melhor suas necessidades
            </p>
          </div>
          
          <div class="form-group">
            <label for="health_insurance" class="block text-sm font-semibold text-navy-800 mb-2">
              Possui Plano de Saúde?
            </label>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="radio" name="has_insurance" value="yes" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Sim, possuo plano de saúde</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="has_insurance" value="no" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Não, atendimento particular</span>
              </label>
            </div>
          </div>
          
          <div class="form-group insurance-details hidden">
            <label for="insurance_name" class="block text-sm font-semibold text-navy-800 mb-2">
              Nome do Plano de Saúde
            </label>
            <input type="text" 
                   id="insurance_name" 
                   name="insurance_name"
                   class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                   placeholder="Ex: Unimed, Bradesco Saúde, SulAmérica">
          </div>
          
          <div class="form-group">
            <label for="specialty_interest" class="block text-sm font-semibold text-navy-800 mb-2">
              Área de Interesse <span class="text-red-500">*</span>
            </label>
            <select id="specialty_interest" 
                    name="specialty_interest"
                    class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                    required>
              <option value="">Selecione a especialidade...</option>
              <option value="psychology">Psicologia</option>
              <option value="psychiatry">Psiquiatria</option>
              <option value="therapy">Terapia</option>
              <option value="counseling">Aconselhamento</option>
              <option value="group_therapy">Terapia em Grupo</option>
              <option value="other">Outro</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="urgency_level" class="block text-sm font-semibold text-navy-800 mb-2">
              Urgência do Atendimento <span class="text-red-500">*</span>
            </label>
            <select id="urgency_level" 
                    name="urgency_level"
                    class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors"
                    required>
              <option value="">Selecione...</option>
              <option value="high">Alta - Preciso de atendimento esta semana</option>
              <option value="medium">Média - Gostaria de ser atendido em 2 semanas</option>
              <option value="low">Baixa - Posso aguardar até 1 mês</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="previous_treatment" class="block text-sm font-semibold text-navy-800 mb-2">
              Já fez tratamento psicológico/psiquiátrico anteriormente?
            </label>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="radio" name="previous_treatment" value="yes" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Sim</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="previous_treatment" value="no" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Não</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="symptoms" class="block text-sm font-semibold text-navy-800 mb-2">
              Principais Sintomas ou Preocupações
            </label>
            <textarea id="symptoms" 
                      name="symptoms"
                      rows="4"
                      class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors resize-none"
                      placeholder="Descreva brevemente seus principais sintomas ou motivos para buscar tratamento..."></textarea>
          </div>
        </div>
        
        <!-- Step 4: Preferences & Confirmation -->
        <div class="step hidden" data-step="4">
          <div class="step-header mb-6">
            <h3 class="text-xl font-display font-bold text-navy-800 mb-2">
              Preferências de Atendimento
            </h3>
            <p class="text-navy-600">
              Finalize seu cadastro com suas preferências
            </p>
          </div>
          
          <div class="form-group">
            <label for="preferred_schedule" class="block text-sm font-semibold text-navy-800 mb-2">
              Horário de Preferência <span class="text-red-500">*</span>
            </label>
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-navy-600 mb-2">Período</label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input type="checkbox" name="preferred_period" value="morning" 
                           class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded">
                    <span class="text-navy-700">Manhã (8h-12h)</span>
                  </label>
                  <label class="flex items-center">
                    <input type="checkbox" name="preferred_period" value="afternoon" 
                           class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded">
                    <span class="text-navy-700">Tarde (13h-17h)</span>
                  </label>
                  <label class="flex items-center">
                    <input type="checkbox" name="preferred_period" value="evening" 
                           class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded">
                    <span class="text-navy-700">Noite (18h-21h)</span>
                  </label>
                </div>
              </div>
              <div>
                <label class="block text-sm text-navy-600 mb-2">Dias da Semana</label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input type="checkbox" name="preferred_days" value="weekdays" 
                           class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded">
                    <span class="text-navy-700">Segunda à Sexta</span>
                  </label>
                  <label class="flex items-center">
                    <input type="checkbox" name="preferred_days" value="saturday" 
                           class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded">
                    <span class="text-navy-700">Sábado</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="session_type" class="block text-sm font-semibold text-navy-800 mb-2">
              Modalidade de Atendimento <span class="text-red-500">*</span>
            </label>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="radio" name="session_type" value="in_person" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Presencial</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="session_type" value="online" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Online (Videochamada)</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="session_type" value="both" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500">
                <span class="text-navy-700">Ambas (Flexível)</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="additional_notes" class="block text-sm font-semibold text-navy-800 mb-2">
              Observações Adicionais
            </label>
            <textarea id="additional_notes" 
                      name="additional_notes"
                      rows="3"
                      class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-4 focus:ring-burgundy-200 focus:border-burgundy-500 transition-colors resize-none"
                      placeholder="Alguma informação adicional que gostaria de compartilhar..."></textarea>
          </div>
          
          <!-- Terms and Privacy -->
          <div class="form-group border-t pt-6">
            <div class="space-y-3">
              <label class="flex items-start">
                <input type="checkbox" name="terms_accepted" value="yes" required
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded mt-1">
                <span class="text-sm text-navy-700">
                  Li e aceito os <a href="#" class="text-burgundy-600 hover:text-burgundy-800 underline">Termos de Uso</a> 
                  e a <a href="#" class="text-burgundy-600 hover:text-burgundy-800 underline">Política de Privacidade</a> 
                  da Sense Clinic <span class="text-red-500">*</span>
                </span>
              </label>
              
              <label class="flex items-start">
                <input type="checkbox" name="contact_consent" value="yes" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded mt-1">
                <span class="text-sm text-navy-700">
                  Autorizo o contato via WhatsApp, email e telefone para agendamento e lembretes de consultas
                </span>
              </label>
              
              <label class="flex items-start">
                <input type="checkbox" name="marketing_consent" value="yes" 
                       class="mr-3 w-4 h-4 text-burgundy-600 focus:ring-burgundy-500 rounded mt-1">
                <span class="text-sm text-navy-700">
                  Aceito receber materiais informativos e promocionais sobre saúde mental e bem-estar
                </span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="form-navigation flex justify-between items-center pt-6 border-t border-neutral-200 sticky bottom-0 bg-white">
          <button type="button" 
                  class="step-prev bg-neutral-200 text-navy-800 px-6 py-3 rounded-lg font-semibold hover:bg-neutral-300 transition-colors focus:ring-4 focus:ring-neutral-200"
                  style="display: none;">
            ← Voltar
          </button>
          
          <div class="flex space-x-3 ml-auto">
            <button type="button" 
                    class="step-next bg-burgundy-700 text-white px-8 py-3 rounded-lg font-semibold hover:bg-burgundy-800 transition-colors focus:ring-4 focus:ring-burgundy-200">
              Próximo →
            </button>
            
            <button type="submit" 
                    class="step-submit bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors focus:ring-4 focus:ring-green-200"
                    style="display: none;">
              Finalizar Cadastro
            </button>
          </div>
        </div>
        
      </form>
    </div>
  </div>
</div>

<!-- Enhanced CSS for multi-step form -->
<style>
.modal {
  backdrop-filter: blur(2px);
}

.step {
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.step.hidden {
  opacity: 0;
  transform: translateX(20px);
  pointer-events: none;
}

.step.active {
  opacity: 1;
  transform: translateX(0);
}

.step-indicator.completed {
  background-color: #81171F !important;
  color: white !important;
}

.step-indicator.active {
  background-color: #B37479;
  color: white;
  transform: scale(1.1);
}

.form-group input.error,
.form-group select.error,
.form-group textarea.error {
  border-color: #EF4444;
  background-color: #FEF2F2;
}

.error-message {
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.progress-fill {
  transition: width 0.5s ease-in-out;
}

.step-indicator {
  transition: all 0.3s ease;
}

.insurance-details.show {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Focus styles for accessibility */
input:focus, select:focus, textarea:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(179, 116, 121, 0.3);
}

/* Loading spinner */
@keyframes spin {
  to { transform: rotate(360deg); }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .modal-content {
    margin: 1rem;
    max-height: calc(100vh - 2rem);
  }
  
  .grid.md\\:grid-cols-2 {
    grid-template-columns: 1fr;
  }
  
  .grid.md\\:grid-cols-3 {
    grid-template-columns: 1fr;
  }
  
  .step-indicator {
    width: 1.5rem;
    height: 1.5rem;
    font-size: 0.75rem;
  }
}
</style>

<script>
// Insurance field toggle
document.addEventListener('DOMContentLoaded', function() {
  const insuranceRadios = document.querySelectorAll('input[name="has_insurance"]');
  const insuranceDetails = document.querySelector('.insurance-details');
  
  insuranceRadios.forEach(radio => {
    radio.addEventListener('change', function() {
      if (this.value === 'yes') {
        insuranceDetails.classList.remove('hidden');
        insuranceDetails.classList.add('show');
      } else {
        insuranceDetails.classList.add('hidden');
        insuranceDetails.classList.remove('show');
      }
    });
  });
  
  // CPF formatting
  const cpfInput = document.getElementById('cpf');
  if (cpfInput) {
    cpfInput.addEventListener('input', function() {
      let value = this.value.replace(/\D/g, '');
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      this.value = value;
    });
  }
  
  // CEP formatting
  const cepInput = document.getElementById('zipcode');
  if (cepInput) {
    cepInput.addEventListener('input', function() {
      let value = this.value.replace(/\D/g, '');
      value = value.replace(/(\d{5})(\d)/, '$1-$2');
      this.value = value;
    });
  }
  
  // Phone formatting
  const phoneInput = document.getElementById('phone');
  if (phoneInput) {
    phoneInput.addEventListener('input', function() {
      let value = this.value.replace(/\D/g, '');
      value = value.replace(/(\d{2})(\d)/, '($1) $2');
      value = value.replace(/(\d{5})(\d)/, '$1-$2');
      this.value = value;
    });
  }
});
</script>