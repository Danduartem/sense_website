{
  "name": "performance-audit",
  "version": "1.0.0",
  "description": "Comprehensive performance optimization workflow for Core Web Vitals",
  "trigger": {
    "manual": ["Performance audit requested"],
    "automatic": {
      "condition": "lighthouse_score < 90",
      "frequency": "bi-weekly"
    }
  },
  "phases": [
    {
      "phase": 1,
      "name": "Baseline Measurement",
      "agents": [
        {
          "agent": "performance-auditor",
          "task": "Run comprehensive Lighthouse audit",
          "timeout": 300,
          "output": "baseline_metrics.json",
          "metrics": ["LCP", "FID", "CLS", "FCP", "TTI", "TBT"]
        }
      ]
    },
    {
      "phase": 2,
      "name": "Issue Analysis",
      "agents": [
        {
          "agent": "eleventy-njk-specialist",
          "task": "Analyze build process and templates",
          "timeout": 300,
          "output": "build_analysis.json"
        },
        {
          "agent": "design-compliance-specialist",
          "task": "Review CSS efficiency and token usage",
          "timeout": 240,
          "parallel": true,
          "output": "css_analysis.json"
        },
        {
          "agent": "frontend-prototyper",
          "task": "Identify JavaScript bottlenecks",
          "timeout": 240,
          "parallel": true,
          "output": "js_analysis.json"
        }
      ]
    },
    {
      "phase": 3,
      "name": "Optimization Implementation",
      "agents": [
        {
          "agent": "performance-auditor",
          "task": "Implement critical performance fixes",
          "timeout": 480,
          "optimizations": [
            "image_optimization",
            "lazy_loading",
            "resource_hints",
            "critical_css",
            "font_optimization"
          ],
          "output": "optimization_report.json"
        },
        {
          "agent": "eleventy-njk-specialist",
          "task": "Optimize build pipeline",
          "timeout": 360,
          "parallel": true,
          "output": "build_optimizations.json"
        }
      ]
    },
    {
      "phase": 4,
      "name": "Validation",
      "agents": [
        {
          "agent": "performance-auditor",
          "task": "Re-run Lighthouse audit",
          "timeout": 300,
          "output": "final_metrics.json"
        },
        {
          "agent": "design-compliance-specialist",
          "task": "Ensure visual fidelity maintained",
          "timeout": 240,
          "parallel": true,
          "output": "visual_validation.json"
        }
      ]
    }
  ],
  "optimization_checklist": {
    "images": [
      "Convert to WebP format",
      "Implement responsive images",
      "Add lazy loading",
      "Optimize file sizes"
    ],
    "css": [
      "Extract critical CSS",
      "Remove unused styles",
      "Minify and compress",
      "Optimize font loading"
    ],
    "javascript": [
      "Code splitting",
      "Tree shaking",
      "Defer non-critical scripts",
      "Minimize main thread work"
    ],
    "caching": [
      "Set cache headers",
      "Implement service worker",
      "Use CDN for assets",
      "Browser cache strategy"
    ]
  },
  "success_metrics": {
    "core_web_vitals": {
      "LCP": "<2.5s",
      "FID": "<100ms",
      "CLS": "<0.1"
    },
    "lighthouse_scores": {
      "performance": ">90",
      "accessibility": ">95",
      "best_practices": ">95",
      "seo": ">95"
    },
    "custom_metrics": {
      "time_to_interactive": "<3.8s",
      "first_contentful_paint": "<1.8s",
      "speed_index": "<3.4s"
    }
  },
  "rollback_plan": {
    "trigger": "performance_regression > 10%",
    "steps": [
      "Revert to previous build",
      "Identify regression cause",
      "Apply targeted fix",
      "Re-validate metrics"
    ]
  },
  "estimated_duration": "3-4 hours",
  "token_budget": 30000,
  "priority": "high",
  "tags": ["performance", "optimization", "core-web-vitals", "lighthouse"]
}